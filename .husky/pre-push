#!/usr/bin/env sh
. "$(dirname -- "$0")/_/husky.sh"

echo "ğŸš€ Running pre-push checks..."

# Get the branch being pushed
protected_branch='main'
current_branch=$(git rev-parse --abbrev-ref HEAD)

if [ "$current_branch" = "$protected_branch" ]; then
    echo "ğŸ›¡ï¸  Pushing to protected branch '$protected_branch'"
    echo "ğŸ” Running comprehensive checks..."
    
    # Run full test suite
    echo "ğŸ§ª Running full test suite..."
    npm run test
    npm run test:coverage
    
    # Run security audit
    echo "ğŸ”’ Running security audit..."
    npm audit --audit-level=moderate
    
    # Verify build works
    echo "ğŸ”¨ Verifying production build..."
    npm run build
    
    echo "âœ… Pre-push checks completed for main branch!"
else
    echo "ğŸ“ Pushing to feature branch '$current_branch'"
    echo "ğŸ” Running basic checks..."
    
    # Run basic checks for feature branches
    npm run lint
    npm run test
    
    echo "âœ… Pre-push checks completed!"
fi